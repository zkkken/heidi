#!/bin/bash
# ============================================
# RPA 自动化运行脚本
# 端到端自动化：启动 → 点击 → 提取 → 传输
# ============================================
#
# 功能：全自动化 RPA 流程
# 1. 自动打开 EMR 和 Heidi 浏览器
# 2. 自动识别并点击第一个病人
# 3. 自动截图并提取数据
# 4. 自动发送到 Heidi API
#
# 使用方法：
#   bash rpa-run.sh
#
# ============================================

set -e

# 进入项目目录
cd "$(dirname "$0")"

# 检查虚拟环境是否存在
if [ ! -d "venv" ]; then
    echo "❌ 虚拟环境不存在！"
    echo "请先运行安装脚本: bash install-venv.sh"
    exit 1
fi

# 检查 .env 文件
if [ ! -f ".env" ]; then
    echo "❌ 配置文件 .env 不存在！"
    echo "请先创建配置文件："
    echo "  cp .env.example .env"
    echo "  然后编辑 .env 文件，填写 HEIDI_API_KEY"
    exit 1
fi

# 激活虚拟环境
source venv/bin/activate

echo "✅ 虚拟环境已激活"
echo "🤖 启动 RPA 自动化模式..."
echo ""
echo "================================================"
echo "  RPA 端到端自动化流程"
echo "================================================"
echo ""
echo "⚠️  重要提示："
echo "  1. 请确保 EMR 系统可以正常访问"
echo "  2. RPA 会自动控制鼠标和键盘"
echo "  3. 执行过程中请勿操作电脑"
echo "  4. 建议首次使用时手动打开 EMR 应用"
echo ""

# 运行 RPA 主程序（传递所有参数）
python integrations/standalone/rpa_main.py "$@"

# 显示完成信息
echo ""
echo "================================================"
echo "✨ RPA 流程执行完毕！"
echo "================================================"

# 注意：虚拟环境会在脚本结束后自动退出
